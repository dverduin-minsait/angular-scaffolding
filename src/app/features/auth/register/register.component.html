<div class="auth-page">
  <div class="auth-container">
    <header class="auth-header">
  <h1 id="register-title">{{ 'app.auth.register.title' | translate }}</h1>
  <p>{{ 'app.auth.register.subtitle' | translate }}</p>
    </header>

    <form class="crud-form" [formGroup]="registerForm" (ngSubmit)="onSubmit()" aria-labelledby="register-title"
      novalidate>

      <fieldset class="field-grid">
  <legend class="visually-hidden">{{ 'app.auth.register.personalInformation' | translate }}</legend>
        <div class="form-field">
          <label class="form-label" for="firstName">{{ 'app.auth.register.firstName' | translate }} <span aria-label="required">*</span></label>
          <input id="firstName" formControlName="firstName" type="text" [placeholder]="'app.auth.register.firstName' | translate" class="form-control"
            required aria-required="true" autocomplete="given-name"
            [attr.aria-invalid]="firstNameError() ? 'true' : 'false'"
            [attr.aria-describedby]="firstNameError() ? 'firstName-error' : null" />
          @if (firstNameError()) {
          <div id="firstName-error" class="form-error" role="alert" aria-live="polite">
            {{ firstNameError() }}
          </div>
          }
        </div>
        <div class="form-field">
          <label class="form-label" for="lastName">{{ 'app.auth.register.lastName' | translate }} <span aria-label="required">*</span></label>
          <input id="lastName" formControlName="lastName" type="text" [placeholder]="'app.auth.register.lastName' | translate" class="form-control"
            required aria-required="true" autocomplete="family-name"
            [attr.aria-invalid]="lastNameError() ? 'true' : 'false'"
            [attr.aria-describedby]="lastNameError() ? 'lastName-error' : null" />
          @if (lastNameError()) {
          <div id="lastName-error" class="form-error" role="alert" aria-live="polite">
            {{ lastNameError() }}
          </div>
          }
        </div>
      </fieldset>

      <div class="form-field">
  <label class="form-label" for="email">{{ 'app.auth.register.email' | translate }} <span aria-label="required">*</span></label>
  <input id="email" formControlName="email" type="email" [placeholder]="'app.auth.register.email' | translate" class="form-control"
          required aria-required="true" email autocomplete="email" [attr.aria-invalid]="emailError() ? 'true' : 'false'"
          [attr.aria-describedby]="emailError() ? 'email-error' : null" />
        @if (emailError()) {
        <div id="email-error" class="form-error" role="alert" aria-live="polite">
          {{ emailError() }}
        </div>
        }
      </div>

      <div class="form-field">
        <fieldset class="radio-group">
          <legend id="gender-label">{{ 'app.auth.register.gender' | translate }} <span aria-label="required">*</span></legend>
          <div class="radio-options" role="radiogroup" [attr.aria-invalid]="genderError() ? 'true' : 'false'"
            [attr.aria-describedby]="genderError() ? 'gender-error' : null" [attr.aria-labelledby]="'gender-label'"
            (keydown)="onRadioKeydown($event)">
            @for (option of genderOptions; track option.value) {
            <label class="radio-option" [attr.for]="'gender-' + option.value">
              <input type="radio" formControlName="gender" [value]="option.value" [id]="'gender-' + option.value"
                name="gender" required [attr.aria-describedby]="genderError() ? 'gender-error' : null" />
              <span class="radio-label">{{ option.label }}</span>
            </label>
            }
          </div>
          @if (genderError()) {
          <div id="gender-error" class="form-error" role="alert" aria-live="polite">
            {{ genderError() }}
          </div>
          }
        </fieldset>
      </div>

      <div class="form-field">
  <label class="form-label" for="language">{{ 'app.auth.register.preferredLanguage' | translate }} <span aria-label="required">*</span></label>
        <select id="language" formControlName="language" class="form-control" required aria-required="true"
          [attr.aria-invalid]="languageError() ? 'true' : 'false'"
          [attr.aria-describedby]="languageError() ? 'language-error' : null">
          @for (lang of availableLanguages; track lang.code) {
          <option [value]="lang.code" [disabled]="lang.code === ''">
            {{ lang.label }}
          </option>
          }
        </select>
        @if (languageError()) {
        <div id="language-error" class="form-error" role="alert" aria-live="polite">
          {{ languageError() }}
        </div>
        }
      </div>

      <div class="form-field">
        <label class="form-label" for="observations">{{ 'app.auth.register.additionalObservations' | translate }}</label>
        <textarea id="observations" formControlName="observations"
          [placeholder]="'app.auth.register.observationsPlaceholder' | translate" class="form-control" rows="3" maxlength="500"
          aria-describedby="observations-hint"></textarea>
        <small id="observations-hint" class="form-hint">{{ 'app.auth.register.observationsHint' | translate }}</small>
      </div>

      <div class="form-field">
        <label class="form-label" for="password">{{ 'app.auth.register.password' | translate }} <span aria-label="required">*</span></label>
        <input id="password" formControlName="password" type="password" [placeholder]="'app.auth.register.passwordPlaceholder' | translate"
          class="form-control" required aria-required="true" minlength="8" autocomplete="new-password"
          [attr.aria-invalid]="passwordError() ? 'true' : 'false'"
          [attr.aria-describedby]="'password-requirements ' + (passwordError() ? 'password-error' : '')"
          (input)="checkPasswordStrength()" />
        <div id="password-requirements" class="password-requirements">
          <p>{{ 'app.auth.register.passwordRequirements' | translate }}</p>
          <ul>
            <li [attr.aria-label]="hasMinLength() ? ('app.status.enabled' | translate) : ('app.status.disabled' | translate)">
              <span [attr.aria-hidden]="true">{{ hasMinLength() ? '✓' : '✗' }}</span>
              {{ 'app.auth.register.passwordReqMin' | translate }}
            </li>
            <li [attr.aria-label]="hasUpperCase() ? ('app.status.enabled' | translate) : ('app.status.disabled' | translate)">
              <span [attr.aria-hidden]="true">{{ hasUpperCase() ? '✓' : '✗' }}</span>
              {{ 'app.auth.register.passwordReqUpper' | translate }}
            </li>
            <li [attr.aria-label]="hasLowerCase() ? ('app.status.enabled' | translate) : ('app.status.disabled' | translate)">
              <span [attr.aria-hidden]="true">{{ hasLowerCase() ? '✓' : '✗' }}</span>
              {{ 'app.auth.register.passwordReqLower' | translate }}
            </li>
            <li [attr.aria-label]="hasNumber() ? ('app.status.enabled' | translate) : ('app.status.disabled' | translate)">
              <span [attr.aria-hidden]="true">{{ hasNumber() ? '✓' : '✗' }}</span>
              {{ 'app.auth.register.passwordReqNumber' | translate }}
            </li>
          </ul>
        </div>
        <div class="password-strength">
          <div class="strength-bar" role="progressbar" [attr.aria-valuenow]="passwordStrengthScore()" aria-valuemin="0"
            aria-valuemax="4" [attr.aria-label]="('app.auth.register.passwordStrength' | translate) + ' ' + passwordStrengthText()">
            <div class="strength-fill" [attr.data-strength]="passwordStrengthClass()"></div>
          </div>
          <span class="strength-text" aria-live="polite" aria-atomic="true">{{ passwordStrengthText() }}</span>
        </div>
        @if (passwordError()) {<div id="password-error" class="form-error" role="alert" aria-live="polite">{{ passwordError() }}</div>}
      </div>

      <div class="form-field">
        <label class="form-label" for="confirmPassword">{{ 'app.auth.register.confirmPassword' | translate }} <span aria-label="required">*</span></label>
        <input id="confirmPassword" formControlName="confirmPassword" type="password"
          [placeholder]="'app.auth.register.confirmPasswordPlaceholder' | translate" class="form-control" required aria-required="true"
          autocomplete="new-password" [attr.aria-invalid]="confirmPasswordError() ? 'true' : 'false'"
          [attr.aria-describedby]="confirmPasswordError() ? 'confirmPassword-error' : null" />
        @if (confirmPasswordError()) {
        <div id="confirmPassword-error" class="form-error" role="alert" aria-live="polite">
          {{ confirmPasswordError() }}
        </div>
        }
      </div>

      <div class="terms-group">
        <input type="checkbox" id="terms" formControlName="agreedToTerms" required
          [attr.aria-invalid]="termsError() ? 'true' : 'false'"
          [attr.aria-describedby]="termsError() ? 'terms-error' : null" />
        <label for="terms">
          {{ 'app.auth.register.termsTextPrefix' | translate }} <a href="/terms" target="_blank" rel="noopener noreferrer">{{ 'app.auth.register.termsService' | translate }} <span
              class="visually-hidden">{{ 'app.auth.register.opensInNewTab' | translate }}</span></a> {{ 'common.and' | translate : { default: 'and' } }} <a href="/privacy" target="_blank"
            rel="noopener noreferrer">{{ 'app.auth.register.privacyPolicy' | translate }} <span class="visually-hidden">{{ 'app.auth.register.opensInNewTab' | translate }}</span></a>
        </label>
        @if (termsError()) {
        <div id="terms-error" class="form-error" role="alert" aria-live="polite">
          {{ termsError() }}
        </div>
        }
      </div>

      <div class="form-actions">
        <button type="submit" appButton variant="primary" [disabled]="!isFormValid() || isSubmitting()"
          [attr.aria-describedby]="submitError() ? 'submit-error' : null">
          {{ isSubmitting() ? ('app.auth.register.submitCreating' | translate) : ('app.auth.register.submitCreate' | translate) }}
        </button>
        <button type="button" appButton variant="secondary" (click)="signUpWithGoogle()" [disabled]="isSubmitting()">
          {{ 'app.auth.register.signUpWithGoogle' | translate }}
        </button>
      </div>

      @if (submitError()) {<div id="submit-error" class="form-error" role="alert" aria-live="assertive">{{ submitError() }}</div>}
    </form>

    <footer class="auth-footer">
      <p>{{ 'app.auth.register.alreadyHaveAccount' | translate }}</p>
      <a routerLink="/auth/login" [attr.aria-label]="'app.actions.goToLoginPage' | translate">{{ 'app.auth.register.signIn' | translate }}</a>
    </footer>
  </div>
</div>