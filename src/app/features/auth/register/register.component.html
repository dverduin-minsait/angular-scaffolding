<div class="auth-page">
  <div class="auth-container">
    <header class="auth-header">
      <h1 id="register-title">Create Account</h1>
      <p>Join us and start your journey</p>
    </header>

    <form class="crud-form" [formGroup]="registerForm" (ngSubmit)="onSubmit()" aria-labelledby="register-title"
      novalidate>

      <fieldset class="field-grid">
        <legend class="visually-hidden">Personal Information</legend>
        <div class="form-field">
          <label class="form-label" for="firstName">First Name <span aria-label="required">*</span></label>
          <input id="firstName" formControlName="firstName" type="text" placeholder="First name" class="form-control"
            required aria-required="true" autocomplete="given-name"
            [attr.aria-invalid]="firstNameError() ? 'true' : 'false'"
            [attr.aria-describedby]="firstNameError() ? 'firstName-error' : null" />
          @if (firstNameError()) {
          <div id="firstName-error" class="form-error" role="alert" aria-live="polite">
            {{ firstNameError() }}
          </div>
          }
        </div>
        <div class="form-field">
          <label class="form-label" for="lastName">Last Name <span aria-label="required">*</span></label>
          <input id="lastName" formControlName="lastName" type="text" placeholder="Last name" class="form-control"
            required aria-required="true" autocomplete="family-name"
            [attr.aria-invalid]="lastNameError() ? 'true' : 'false'"
            [attr.aria-describedby]="lastNameError() ? 'lastName-error' : null" />
          @if (lastNameError()) {
          <div id="lastName-error" class="form-error" role="alert" aria-live="polite">
            {{ lastNameError() }}
          </div>
          }
        </div>
      </fieldset>

      <div class="form-field">
        <label class="form-label" for="email">Email <span aria-label="required">*</span></label>
        <input id="email" formControlName="email" type="email" placeholder="Enter your email" class="form-control"
          required aria-required="true" email autocomplete="email" [attr.aria-invalid]="emailError() ? 'true' : 'false'"
          [attr.aria-describedby]="emailError() ? 'email-error' : null" />
        @if (emailError()) {
        <div id="email-error" class="form-error" role="alert" aria-live="polite">
          {{ emailError() }}
        </div>
        }
      </div>

      <div class="form-field">
        <fieldset class="radio-group">
          <legend id="gender-label">Gender <span aria-label="required">*</span></legend>
          <div class="radio-options" role="radiogroup" [attr.aria-invalid]="genderError() ? 'true' : 'false'"
            [attr.aria-describedby]="genderError() ? 'gender-error' : null" [attr.aria-labelledby]="'gender-label'"
            (keydown)="onRadioKeydown($event)">
            @for (option of genderOptions; track option.value) {
            <label class="radio-option" [attr.for]="'gender-' + option.value">
              <input type="radio" formControlName="gender" [value]="option.value" [id]="'gender-' + option.value"
                name="gender" required [attr.aria-describedby]="genderError() ? 'gender-error' : null" />
              <span class="radio-label">{{ option.label }}</span>
            </label>
            }
          </div>
          @if (genderError()) {
          <div id="gender-error" class="form-error" role="alert" aria-live="polite">
            {{ genderError() }}
          </div>
          }
        </fieldset>
      </div>

      <div class="form-field">
        <label class="form-label" for="language">Preferred Language <span aria-label="required">*</span></label>
        <select id="language" formControlName="language" class="form-control" required aria-required="true"
          [attr.aria-invalid]="languageError() ? 'true' : 'false'"
          [attr.aria-describedby]="languageError() ? 'language-error' : null">
          @for (lang of availableLanguages; track lang.code) {
          <option [value]="lang.code" [disabled]="lang.code === ''">
            {{ lang.label }}
          </option>
          }
        </select>
        @if (languageError()) {
        <div id="language-error" class="form-error" role="alert" aria-live="polite">
          {{ languageError() }}
        </div>
        }
      </div>

      <div class="form-field">
        <label class="form-label" for="observations">Additional Observations</label>
        <textarea id="observations" formControlName="observations"
          placeholder="Any additional comments or notes (optional)" class="form-control" rows="3" maxlength="500"
          aria-describedby="observations-hint"></textarea>
        <small id="observations-hint" class="form-hint">Optional field. Maximum 500 characters.</small>
      </div>

      <div class="form-field">
        <label class="form-label" for="password">Password <span aria-label="required">*</span></label>
        <input id="password" formControlName="password" type="password" placeholder="Create a password"
          class="form-control" required aria-required="true" minlength="8" autocomplete="new-password"
          [attr.aria-invalid]="passwordError() ? 'true' : 'false'"
          [attr.aria-describedby]="'password-requirements ' + (passwordError() ? 'password-error' : '')"
          (input)="checkPasswordStrength()" />
        <div id="password-requirements" class="password-requirements">
          <p>Password requirements:</p>
          <ul>
            <li [attr.aria-label]="hasMinLength() ? 'Requirement met' : 'Requirement not met'">
              <span [attr.aria-hidden]="true">{{ hasMinLength() ? '✓' : '✗' }}</span>
              At least 8 characters
            </li>
            <li [attr.aria-label]="hasUpperCase() ? 'Requirement met' : 'Requirement not met'">
              <span [attr.aria-hidden]="true">{{ hasUpperCase() ? '✓' : '✗' }}</span>
              One uppercase letter
            </li>
            <li [attr.aria-label]="hasLowerCase() ? 'Requirement met' : 'Requirement not met'">
              <span [attr.aria-hidden]="true">{{ hasLowerCase() ? '✓' : '✗' }}</span>
              One lowercase letter
            </li>
            <li [attr.aria-label]="hasNumber() ? 'Requirement met' : 'Requirement not met'">
              <span [attr.aria-hidden]="true">{{ hasNumber() ? '✓' : '✗' }}</span>
              One number
            </li>
          </ul>
        </div>
        <div class="password-strength">
          <div class="strength-bar" role="progressbar" [attr.aria-valuenow]="passwordStrengthScore()" aria-valuemin="0"
            aria-valuemax="4" [attr.aria-label]="'Password strength: ' + passwordStrengthText()">
            <div class="strength-fill" [attr.data-strength]="passwordStrengthClass()"></div>
          </div>
          <span class="strength-text" aria-live="polite" aria-atomic="true">{{ passwordStrengthText() }}</span>
        </div>
        @if (passwordError()) {<div id="password-error" class="form-error" role="alert" aria-live="polite">{{ passwordError() }}</div>}
      </div>

      <div class="form-field">
        <label class="form-label" for="confirmPassword">Confirm Password <span aria-label="required">*</span></label>
        <input id="confirmPassword" formControlName="confirmPassword" type="password"
          placeholder="Confirm your password" class="form-control" required aria-required="true"
          autocomplete="new-password" [attr.aria-invalid]="confirmPasswordError() ? 'true' : 'false'"
          [attr.aria-describedby]="confirmPasswordError() ? 'confirmPassword-error' : null" />
        @if (confirmPasswordError()) {
        <div id="confirmPassword-error" class="form-error" role="alert" aria-live="polite">
          {{ confirmPasswordError() }}
        </div>
        }
      </div>

      <div class="terms-group">
        <input type="checkbox" id="terms" formControlName="agreedToTerms" required
          [attr.aria-invalid]="termsError() ? 'true' : 'false'"
          [attr.aria-describedby]="termsError() ? 'terms-error' : null" />
        <label for="terms">
          I agree to the <a href="/terms" target="_blank" rel="noopener noreferrer">Terms of Service <span
              class="visually-hidden">(opens in new tab)</span></a> and <a href="/privacy" target="_blank"
            rel="noopener noreferrer">Privacy Policy <span class="visually-hidden">(opens in new tab)</span></a>
        </label>
        @if (termsError()) {
        <div id="terms-error" class="form-error" role="alert" aria-live="polite">
          {{ termsError() }}
        </div>
        }
      </div>

      <div class="form-actions">
        <button type="submit" appButton variant="primary" [disabled]="!isFormValid() || isSubmitting()"
          [attr.aria-describedby]="submitError() ? 'submit-error' : null">
          {{ isSubmitting() ? 'Creating Account...' : 'Create Account' }}
        </button>
        <button type="button" appButton variant="secondary" (click)="signUpWithGoogle()" [disabled]="isSubmitting()">
          Sign up with Google
        </button>
      </div>

      @if (submitError()) {<div id="submit-error" class="form-error" role="alert" aria-live="assertive">{{ submitError() }}</div>}
    </form>

    <footer class="auth-footer">
      <p>Already have an account?</p>
      <a routerLink="/auth/login" aria-label="Go to login page">Sign in</a>
    </footer>
  </div>
</div>