<!-- Mobile Sidebar Overlay -->
<div class="sidebar-overlay" 
     [class.open]="isOpen()" 
     (click)="closeSidebar()"
     [attr.aria-hidden]="!isOpen()"
     [attr.inert]="!isOpen() || null">
</div>

<!-- Mobile Sidebar -->
<aside id="mobile-sidebar"
       class="sidebar" 
       [class.open]="isOpen()"
       [attr.aria-hidden]="!isOpen()"
       [attr.inert]="!isOpen() || null"
       role="navigation"
       aria-label="Mobile navigation"
       [attr.tabindex]="isOpen() ? '0' : '-1'">
  <div class="sidebar-content">
    <div class="sidebar-header">
      <h2 id="sidebar-title">{{ title() | translate }}</h2>
      <button 
        class="close-button"
        (click)="closeSidebar()"
        [attr.aria-label]="'app.actions.closeMenu' | translate"
        type="button"
        [attr.tabindex]="isOpen() ? '0' : '-1'"
      >
        ✕
      </button>
    </div>
    
    <nav class="sidebar-nav" aria-labelledby="sidebar-title" (keydown)="onNavKeydown($event)">
      <ul class="sidebar-nav-list root">
        <ng-container *ngTemplateOutlet="recursiveNav; context: { items: items(), depth: 0 }"></ng-container>
      </ul>
    </nav>

    <!-- Footer content slot for actions like language selector and theme toggle -->
    <div class="sidebar-footer">
      <ng-content></ng-content>
    </div>
  </div>
</aside>

<ng-template #recursiveNav let-items="items" let-depth="depth">
  @for (item of items; track trackById($index, item)) {
    <li class="sidebar-nav-item" [class.is-group]="isGroup(item)" [class.depth-{{depth}}]="true">
      @if (!isGroup(item)) {
        <a [routerLink]="item.path" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" 
           class="sidebar-nav-link" [class.sub]="depth>0"
           [attr.aria-label]="item.label | translate" [attr.aria-current]="isLinkActive(item.path!) ? 'page' : null"
           [attr.tabindex]="isOpen() ? '0' : '-1'" (click)="onLinkClick()">
          @if (item.icon && depth === 0) { <span class="sidebar-nav-icon" aria-hidden="true">{{ item.icon }}</span> }
          {{ item.label | translate }}
        </a>
      } @else {
        <div class="sidebar-group" [class.nested]="depth>0">
          <button type="button" class="sidebar-group-toggle" [class.nested]="depth>0" (click)="toggleGroup(item.id)"
                  [attr.aria-expanded]="isGroupOpen(item.id)" [attr.aria-controls]="'mside-'+item.id"
                  [attr.tabindex]="isOpen() ? '0' : '-1'">
            <span class="chevron" [class.open]="isGroupOpen(item.id)" aria-hidden="true">▸</span>
            @if (item.icon && depth === 0) { <span class="sidebar-nav-icon" aria-hidden="true">{{ item.icon }}</span> }
            <span class="label">{{ item.label | translate }}</span>
          </button>
          <ul class="sidebar-sub-list" [class.nested]="depth>0" [id]="'mside-'+item.id" role="group" 
              [class.open]="isGroupOpen(item.id)" [attr.aria-hidden]="!isGroupOpen(item.id)">
            <ng-container *ngTemplateOutlet="recursiveNav; context: { items: item.children, depth: depth + 1 }"></ng-container>
          </ul>
        </div>
      }
    </li>
  }
</ng-template>
