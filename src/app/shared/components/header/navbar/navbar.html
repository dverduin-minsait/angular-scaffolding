<nav class="desktop-nav" role="navigation" aria-label="Main navigation" (keydown)="onNavKeydown($event)">
  <ul class="nav-list root">
    <ng-container *ngTemplateOutlet="recursiveNav; context: { items: items(), depth: 0 }"></ng-container>
  </ul>
</nav>

<ng-template #recursiveNav let-items="items" let-depth="depth">
  @for (item of items; track trackById($index, item)) {
    <li class="nav-item" [class.is-group]="isGroup(item)" [class.depth-{{depth}}]="true">
      @if (!isGroup(item)) {
        <a [routerLink]="item.path" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" class="nav-link"
           [attr.aria-label]="item.label | translate" [attr.aria-current]="isLinkActive(item.path!) ? 'page' : null">
          @if (item.icon && depth === 0) { <span class="nav-icon" aria-hidden="true">{{ item.icon }}</span> }
          {{ item.label | translate }}
        </a>
      } @else {
        <div class="nav-group" [class.nested]="depth > 0" 
             (mouseenter)="onGroupMouseEnter(item.id, depth)" 
             (mouseleave)="onGroupMouseLeave(item.id, depth, $event)">
          <button type="button" class="nav-group-toggle" [class.nested]="depth>0"
                  [attr.aria-expanded]="isGroupOpen(item.id)" [attr.aria-controls]="'grp-'+item.id"
                  (click)="toggleGroup(item.id)">
            <span class="chevron" [class.open]="isGroupOpen(item.id)" aria-hidden="true">â–¸</span>
            @if (item.icon && depth === 0) { <span class="nav-icon" aria-hidden="true">{{ item.icon }}</span> }
            <span class="label">{{ item.label | translate }}</span>
          </button>
          <ul class="nav-sub-list" [class.nested]="depth>0" [id]="'grp-'+item.id" role="group"
              [class.open]="isGroupOpen(item.id)" [attr.inert]="!isGroupOpen(item.id) ? '' : null">
            <ng-container *ngTemplateOutlet="recursiveNav; context: { items: item.children, depth: depth + 1 }"></ng-container>
          </ul>
        </div>
      }
    </li>
  }
</ng-template>
