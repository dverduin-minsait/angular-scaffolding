<header class="header" role="banner">
  <div class="header-content">
    <div class="logo">
      <h1>{{ title() | translate}}</h1>
    </div>
    
    <!-- Desktop Navigation -->
    <nav id="navigation" class="navigation desktop-nav" role="navigation" aria-label="Main navigation">
      <ul class="nav-list root">
        @for (item of navigationItems(); track trackById($index, item)) {
          <li class="nav-item" [class.is-group]="isGroup(item)">
            @if (!isGroup(item)) {
              <a
                [routerLink]="item.path"
                routerLinkActive="active"
                class="nav-link"
                [attr.aria-label]="item.label | translate"
                [attr.aria-current]="isLinkActive(item.path!) ? 'page' : null">
                @if (item.icon) { <span class="nav-icon" aria-hidden="true">{{ item.icon }}</span> }
                {{ item.label | translate }}
              </a>
            } @else {
              <div class="nav-group">
                <button type="button"
                        class="nav-group-toggle"
                        [attr.aria-expanded]="isGroupOpen(item.id)"
                        [attr.aria-controls]="'grp-'+item.id"
                        (click)="toggleGroup(item.id)">
                  <span class="chevron" [class.open]="isGroupOpen(item.id)" aria-hidden="true">▸</span>
                  @if (item.icon) { <span class="nav-icon" aria-hidden="true">{{ item.icon }}</span> }
                  <span class="label">{{ item.label | translate }}</span>
                </button>
                <ul class="nav-sub-list" 
                    [id]="'grp-'+item.id" 
                    role="group"
                    [class.open]="isGroupOpen(item.id)" 
                    [attr.aria-hidden]="!isGroupOpen(item.id)">
                  @for (child of item.children; track trackById($index, child)) {
                    <li class="nav-sub-item" [class.is-group]="isGroup(child)">
                      @if (!isGroup(child)) {
                        <a [routerLink]="child.path" routerLinkActive="active" class="nav-link sub"
                           [attr.aria-label]="child.label | translate" 
                           [attr.aria-current]="isLinkActive(child.path!) ? 'page' : null">
                          {{ child.label | translate }}
                        </a>
                      } @else {
                        <!-- Nested group recursion (one more level) -->
                        <div class="nav-group nested">
                          <button type="button" class="nav-group-toggle nested"
                                  [attr.aria-expanded]="isGroupOpen(child.id)"
                                  [attr.aria-controls]="'grp-'+child.id"
                                  (click)="toggleGroup(child.id)">
                            <span class="chevron" [class.open]="isGroupOpen(child.id)" aria-hidden="true">▸</span>
                            <span class="label">{{ child.label | translate }}</span>
                          </button>
                          <ul class="nav-sub-list nested" [id]="'grp-'+child.id" role="group" [class.open]="isGroupOpen(child.id)" [attr.aria-hidden]="!isGroupOpen(child.id)">
                            @for (leaf of child.children; track trackById($index, leaf)) {
                              <li class="nav-sub-item leaf">
                                @if (!isGroup(leaf)) {
                                  <a [routerLink]="leaf.path" routerLinkActive="active" class="nav-link sub nested"
                                     [attr.aria-label]="leaf.label | translate"
                                     [attr.aria-current]="isLinkActive(leaf.path!) ? 'page' : null">{{ leaf.label | translate }}</a>
                                } @else {
                                  <!-- Future deeper recursion can be implemented if needed -->
                                  <span class="nav-recursion-warning" aria-hidden="true">…</span>
                                }
                              </li>
                            }
                          </ul>
                        </div>
                      }
                    </li>
                  }
                </ul>
              </div>
            }
          </li>
        }
      </ul>
    </nav>
    
    <div class="header-actions">
      <label for="lang-select" class="visually-hidden">{{ 'app.actions.changeLanguage' | translate }}</label>
      <select id="lang-select"
              class="lang-select"
              [value]="i18n.currentLang()"
              (change)="onLanguageChange($event)"
              aria-label="{{ 'app.actions.changeLanguage' | translate }}">
        @for (lang of languages; track lang) {
          <option [value]="lang">{{ ('app.languages.' + lang) | translate }}</option>
        }
      </select>
      <button 
        class="theme-toggle"
        (click)="toggleTheme()"
        [attr.aria-label]="themeAriaLabel()"
        [attr.aria-pressed]="isDarkMode()"
        type="button"
      >
        {{ themeIcon() }}
      </button>
      
      <!-- Burger Menu Button -->
      <button 
        class="burger-menu"
        (click)="toggleSidebar()"
        [attr.aria-label]="burgerAriaLabel()"
        [attr.aria-expanded]="isSidebarOpen()"
        [attr.aria-controls]="'mobile-sidebar'"
        type="button"
      >
        <span class="burger-line" [class.open]="isSidebarOpen()"></span>
        <span class="burger-line" [class.open]="isSidebarOpen()"></span>
        <span class="burger-line" [class.open]="isSidebarOpen()"></span>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Sidebar -->
<div class="sidebar-overlay" 
     [class.open]="isSidebarOpen()" 
     (click)="closeSidebar()"
     [attr.aria-hidden]="!isSidebarOpen()"
     [attr.inert]="!isSidebarOpen() || null">
</div>

<aside id="mobile-sidebar"
       class="sidebar" 
       [class.open]="isSidebarOpen()"
       [attr.aria-hidden]="!isSidebarOpen()"
       [attr.inert]="!isSidebarOpen() || null"
       role="navigation"
       aria-label="Mobile navigation"
       [attr.tabindex]="isSidebarOpen() ? '0' : '-1'">
  <div class="sidebar-content">
    <div class="sidebar-header">
  <h2 id="sidebar-title">{{ title() | translate }}</h2>
      <button 
        class="close-button"
        (click)="closeSidebar()"
        [attr.aria-label]="'app.actions.closeMenu' | translate"
        type="button"
        [attr.tabindex]="isSidebarOpen() ? '0' : '-1'"
      >
        ✕
      </button>
    </div>
    
    <nav class="sidebar-nav" aria-labelledby="sidebar-title">
      <ul class="sidebar-nav-list root">
        @for (item of navigationItems(); track trackById($index, item)) {
          <li class="sidebar-nav-item" [class.is-group]="isGroup(item)">
            @if (!isGroup(item)) {
              <a [routerLink]="item.path" routerLinkActive="active" class="sidebar-nav-link"
                 [attr.aria-label]="item.label | translate" [attr.aria-current]="isLinkActive(item.path!) ? 'page' : null"
                 [attr.tabindex]="isSidebarOpen() ? '0' : '-1'" (click)="closeSidebar()">
                @if (item.icon) { <span class="sidebar-nav-icon" aria-hidden="true">{{ item.icon }}</span> }
                {{ item.label | translate }}
              </a>
            } @else {
              <div class="sidebar-group">
                <button type="button" class="sidebar-group-toggle" (click)="toggleGroup(item.id)"
                        [attr.aria-expanded]="isGroupOpen(item.id)" [attr.aria-controls]="'mside-'+item.id"
                        [attr.tabindex]="isSidebarOpen() ? '0' : '-1'">
                  <span class="chevron" [class.open]="isGroupOpen(item.id)" aria-hidden="true">▸</span>
                  @if (item.icon) { <span class="sidebar-nav-icon" aria-hidden="true">{{ item.icon }}</span> }
                  <span class="label">{{ item.label | translate }}</span>
                </button>
                <ul class="sidebar-sub-list" [id]="'mside-'+item.id" role="group" [class.open]="isGroupOpen(item.id)" [attr.aria-hidden]="!isGroupOpen(item.id)">
                  @for (child of item.children; track trackById($index, child)) {
                    <li class="sidebar-sub-item" [class.is-group]="isGroup(child)">
                      @if (!isGroup(child)) {
                        <a [routerLink]="child.path" routerLinkActive="active" class="sidebar-nav-link sub"
                           [attr.aria-label]="child.label | translate" [attr.aria-current]="isLinkActive(child.path!) ? 'page' : null"
                           [attr.tabindex]="isSidebarOpen() ? '0' : '-1'" (click)="closeSidebar()">{{ child.label | translate }}</a>
                      } @else {
                        <div class="sidebar-group nested">
                          <button type="button" class="sidebar-group-toggle nested" (click)="toggleGroup(child.id)"
                                  [attr.aria-expanded]="isGroupOpen(child.id)" [attr.aria-controls]="'mside-'+child.id"
                                  [attr.tabindex]="isSidebarOpen() ? '0' : '-1'">
                            <span class="chevron" [class.open]="isGroupOpen(child.id)" aria-hidden="true">▸</span>
                            <span class="label">{{ child.label | translate }}</span>
                          </button>
                          <ul class="sidebar-sub-list nested" [id]="'mside-'+child.id" role="group" [class.open]="isGroupOpen(child.id)" [attr.aria-hidden]="!isGroupOpen(child.id)">
                            @for (leaf of child.children; track trackById($index, leaf)) {
                              <li class="sidebar-sub-item leaf">
                                @if (!isGroup(leaf)) {
                                  <a [routerLink]="leaf.path" routerLinkActive="active" class="sidebar-nav-link sub nested"
                                     [attr.aria-label]="leaf.label | translate" [attr.aria-current]="isLinkActive(leaf.path!) ? 'page' : null"
                                     [attr.tabindex]="isSidebarOpen() ? '0' : '-1'" (click)="closeSidebar()">{{ leaf.label | translate }}</a>
                                } @else {
                                  <span class="nav-recursion-warning" aria-hidden="true">…</span>
                                }
                              </li>
                            }
                          </ul>
                        </div>
                      }
                    </li>
                  }
                </ul>
              </div>
            }
          </li>
        }
      </ul>
    </nav>
    
    <div class="sidebar-footer">
      <div class="sidebar-lang">
        <label for="sidebar-lang-select" class="visually-hidden">{{ 'app.actions.changeLanguage' | translate }}</label>
        <select id="sidebar-lang-select"
                class="lang-select"
                [value]="i18n.currentLang()"
                (change)="onLanguageChange($event)"
                [attr.tabindex]="isSidebarOpen() ? '0' : '-1'"
                aria-label="{{ 'app.actions.changeLanguage' | translate }}">
          @for (lang of languages; track lang) {
            <option [value]="lang">{{ ('app.languages.' + lang) | translate }}</option>
          }
        </select>
      </div>
      <button 
        class="sidebar-theme-toggle"
        (click)="toggleTheme()"
        [attr.aria-label]="themeAriaLabel()"
        [attr.aria-pressed]="isDarkMode()"
        [attr.tabindex]="isSidebarOpen() ? '0' : '-1'"
        type="button"
      >
        {{ themeIcon() }}
        <span>{{ ('app.themes.' + (isDarkMode() ? 'light' : 'dark')) | translate }}</span>
      </button>
    </div>
  </div>
</aside>